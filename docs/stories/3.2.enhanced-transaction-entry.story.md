# Story 3.2: Enhanced Transaction Entry with Categorization and Currency Conversion

## Status
Draft

## Story
**As a** user,
**I want** to categorize my transactions during entry, quickly repeat common transactions, and see all values in my local currency (Indian Rupees),
**so that** I can maintain detailed and accurate financial records efficiently without repetitive data entry or manual currency conversion.

## Acceptance Criteria

### Functional
1.  Transaction entry form includes category selection with visual category indicators.
2.  Smart suggestions for categories are provided based on transaction description and historical patterns.
3.  Quick-add functionality is available for frequently used transaction patterns (templates).
4.  Bulk transaction entry capability for multiple similar transactions.
5.  Transaction splitting functionality to assign portions of a single transaction to different categories.
6.  Automatic categorization suggestions based on merchant name or description patterns.
7.  Transaction templates for recurring purchases with pre-filled category and amount.
8.  Photo attachment capability for receipts and transaction documentation.

### Currency Conversion
9.  All currency values throughout the application are displayed in Indian Rupees (₹) instead of US Dollars ($).
10. User preferences in the database are updated to reflect "INR" as the default currency.
11. A currency utility function is created or updated to handle formatting for INR, including the "₹" symbol.
12. All relevant UI components for displaying monetary values are updated to use the new currency utility.
13. The database schema for user preferences is updated to default to "INR".

## Dev Notes

### Previous Story Insights
Story 3.1 focused on navigation. This story will build upon the transaction management features from Story 2.2 and the account management from 2.1. The user has explicitly requested to change the currency from USD to INR.

### Architecture Context
-   **Currency Formatting:** The architecture specifies using `Intl.NumberFormat + Custom Utils`. This needs to be updated to support INR. The file `src/lib/utils/decimal.ts` contains the `formatCurrency` function that will need modification.
-   **Data Models:** The `UserPreferences` object in the `User` data model (`src/lib/db/schema.ts`) must be updated. The `currency` field should be changed from "USD" to "INR".
-   **API Specification:** The `POST /transactions` endpoint will need to be enhanced to support the new features.

### Files to Modify
-   `src/lib/utils/decimal.ts`: Update `formatCurrency` to default to INR.
-   `src/lib/db/schema.ts`: Change the default currency in `UserPreferences` to "INR".
-   `drizzle/migrations/0000_keen_malice.sql`: The initial migration should be updated to reflect the new default currency.
-   `src/components/accounts/account-create-form.tsx`: Update hardcoded `$` symbol.
-   `src/components/accounts/account-list.tsx`: Update currency display.
-   `src/components/dashboard/account-balance-summary.tsx`: Update currency display.
-   `src/components/transactions/transaction-create-form.tsx`: Implement new features and update currency display.
-   `src/components/transactions/transaction-list.tsx`: Update currency display.
-   `src/components/transactions/transaction-delete-dialog.tsx`: Update currency display.
-   `src/components/transactions/transaction-edit-form.tsx`: Update currency display.

## Tasks / Subtasks

### Currency Conversion
- [ ] **Task 1: Update Database Schema** (AC: 10, 13)
    - [ ] Modify `src/lib/db/schema.ts` to change the default currency in `UserPreferences` from 'USD' to 'INR'.
    - [ ] Generate a new database migration to apply the schema change.
- [ ] **Task 2: Update Currency Formatting Utility** (AC: 11)
    - [ ] Modify the `formatCurrency` function in `src/lib/utils/decimal.ts` to use 'INR' as the default currency and '₹' as the symbol.
- [ ] **Task 3: Update UI Components** (AC: 12)
    - [ ] Search for all instances of the "$" symbol and replace them with the new `formatCurrency` utility.
    - [ ] Update all components that display currency to use the updated `formatCurrency` utility.

### Enhanced Transaction Entry
- [ ] **Task 4: Enhance Transaction Entry Form** (AC: 1, 2, 7, 8)
    - [ ] Add a category selection dropdown to the transaction entry form.
    - [ ] Implement "smart" category suggestions based on the transaction description.
    - [ ] Add functionality to create and use transaction templates.
    - [ ] Add the ability to attach a photo of a receipt to a transaction.
- [ ] **Task 5: Implement Transaction Splitting and Bulk Entry** (AC: 4, 5)
    - [ ] Add functionality to split a single transaction into multiple categories.
    - [ ] Implement a UI for bulk-adding multiple transactions at once.
- [ ] **Task 6: Testing**
    - [ ] Write unit and integration tests for the new currency functionality.
    - [ ] Write tests for the new transaction entry features.

## Testing

### Testing Standards
[Source: docs/architecture/architecture.md]
- Test file location: `src/__tests__/`
- Test standards: Follow existing test patterns and coverage targets (80%+)
- Testing frameworks and patterns to use: Vitest + Testing Library for frontend, Vitest + Supertest for backend
- Any specific testing requirements for this story: Ensure all currency values are displayed in INR across all components and API responses.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-16 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used
<!-- To be filled by the development agent -->

### Debug Log References
<!-- To be filled by the development agent -->

### Completion Notes List
<!-- To be filled by the development agent -->

### File List
<!-- To be filled by the development agent -->

## QA Results
<!-- To be filled by the QA agent -->